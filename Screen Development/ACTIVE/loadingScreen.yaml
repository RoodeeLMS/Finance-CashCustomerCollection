Screens:
  loadingScreen:
    Properties:
      Fill: =RGBA(33,68,102,1)
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
      OnVisible: |-
        =// Lookup user role in Dataverse
        Set(
            gblCurrentUserRole,
            LookUp(
                '[THFinanceCashCollection]RoleAssignments',
                Email = Office365Users.MyProfile().Mail
            )
        );

        // Set global role flags based on lookup result
        Set(gblIsAdmin, !IsBlank(gblCurrentUserRole) && gblCurrentUserRole.Role.RoleName = "Admin");
        Set(gblIsAR, !IsBlank(gblCurrentUserRole) && (gblCurrentUserRole.Role.RoleName = "AR"));

        UpdateContext({isLoadingReady: false});


        // Initialize navigation based on role
        If(
            gblIsAdmin,
            ClearCollect(
                Navigation,
                Table(
                    {name: "Daily Control Center", screen: scnDashboard, color: RGBA(0, 101, 161, 1)},
                    {name: "Email Approval", screen: scnEmailApproval, color: RGBA(0, 101, 161, 1)},
                    {name: "Email Monitor", screen: scnEmailMonitor, color: RGBA(0, 101, 161, 1)},
                    {name: "Customer Management", screen: scnCustomer, color: RGBA(0, 101, 161, 1)},
                    {name: "Customer History", screen: scnCustomerHistory, color: RGBA(0, 101, 161, 1)},
                    {name: "Transactions", screen: scnTransactions, color: RGBA(0, 101, 161, 1)},
                    {name: "Role Management", screen: scnRole, color: RGBA(100, 81, 61, 1)}
                )
            ),
            gblIsAR,
            ClearCollect(
                Navigation,
                Table(
                    {name: "Daily Control Center", screen: scnDashboard, color: RGBA(0, 101, 161, 1)},
                    {name: "Email Approval", screen: scnEmailApproval, color: RGBA(0, 101, 161, 1)},
                    {name: "Email Monitor", screen: scnEmailMonitor, color: RGBA(0, 101, 161, 1)},
                    {name: "Customer Management", screen: scnCustomer, color: RGBA(0, 101, 161, 1)},
                    {name: "Customer History", screen: scnCustomerHistory, color: RGBA(0, 101, 161, 1)},
                    {name: "Transactions", screen: scnTransactions, color: RGBA(0, 101, 161, 1)},
                    {name: "Role Management", screen: scnRole, color: RGBA(100, 81, 61, 1)}
                )
            )
        );

        // Mark loading as ready
        UpdateContext({isLoadingReady: true});
    Children:
      - Container5:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            DropShadow: =DropShadow.None
            Height: =500
            LayoutDirection: =LayoutDirection.Vertical
            Width: =400
            X: =(Parent.Width-Self.Width)/2
            Y: =(Parent.Height-Self.Height)/2
          Children:
            - Image2:
                Control: Image@2.2.3
                Properties:
                  BorderColor: =RGBA(0, 18, 107, 1)
                  Height: =400
                  Image: =CustomerDataLogo
                  Width: =Parent.Width
            - TextCanvas1:
                Control: Text@0.0.51
                Properties:
                  Align: ='TextCanvas.Align'.Center
                  Font: =Font.Lato
                  FontColor: =RGBA(255, 255, 255, 1)
                  Height: =100
                  Size: =30
                  Text: ="Cash Customer Collection"
                  VerticalAlign: =VerticalAlign.Middle
                  Weight: ='TextCanvas.Weight'.Bold
                  Width: =Parent.Width
                  X: =(Parent.Width-Self.Width)/2
                  Y: =(Parent.Height-Self.Height)/2
      - Timer1:
          Control: Timer@2.1.0
          Properties:
            AutoStart: =isLoadingReady
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Duration: =500
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnTimerEnd: |-
              =// Navigate based on role
              If(
                  gblIsAdmin || gblIsAR,
                  Navigate(scnDashboard, ScreenTransition.Fade),
                  Navigate(scnUnauthorized, ScreenTransition.Fade)
              )
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Start: =isLoadingReady
            Y: =635
