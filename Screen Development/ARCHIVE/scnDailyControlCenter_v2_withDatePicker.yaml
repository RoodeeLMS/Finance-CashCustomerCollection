Screens:
  scnDailyControlCenter:
    Properties:
      Fill: =RGBA(243, 242, 241, 1)
      LoadingSpinnerColor: =RGBA(100, 81, 61, 1)
      OnVisible: |-
        =// Initialize navigation and menu
        Set(_showMenu, false);
        Set(_refreshTrigger, false);
        UpdateContext({currentScreen: "Daily Control Center"});

        // Initialize selected date to today if not set
        If(
            IsBlank(_selectedDate),
            Set(_selectedDate, Today())
        );

        // Refresh data sources
        Refresh('[THFinanceCashCollection]Process Logs');
        Refresh('[THFinanceCashCollection]Emaillogs');
        Refresh('[THFinanceCashCollection]Transactions');
        Refresh('[THFinanceCashCollection]Customers');

        // Get process log for selected date (cr7bb_processdate is TEXT type)
        Set(
            _selectedProcessLog,
            First(
                Filter(
                    '[THFinanceCashCollection]Process Logs',
                    cr7bb_processdate = Text(_selectedDate, "yyyy-mm-dd")
                )
            )
        );

        // Calculate email statistics for selected date (cr7bb_sentdatetime is DateTime type)
        Set(
            _emailStats,
            {
                Sent: CountRows(
                    Filter(
                        '[THFinanceCashCollection]Emaillogs',
                        DateValue(cr7bb_sentdatetime) = _selectedDate &&
                        cr7bb_sendstatus = 'Send Status Choice'.Sent
                    )
                ),
                Failed: CountRows(
                    Filter(
                        '[THFinanceCashCollection]Emaillogs',
                        DateValue(cr7bb_sentdatetime) = _selectedDate &&
                        cr7bb_sendstatus = 'Send Status Choice'.Failed
                    )
                ),
                Skipped: CountRows(
                    Filter(
                        '[THFinanceCashCollection]Emaillogs',
                        DateValue(cr7bb_sentdatetime) = _selectedDate &&
                        cr7bb_sendstatus = 'Send Status Choice'.Skipped
                    )
                )
            }
        );

        // Get important customers for selected date
        ClearCollect(
            colImportantCustomers,
            Filter(
                AddColumns(
                    '[THFinanceCashCollection]Customers',
                    TotalDue,
                    Sum(
                        Filter(
                            '[THFinanceCashCollection]Transactions',
                            cr7bb_customercode = ThisRecord.cr7bb_customercode &&
                            !cr7bb_processed
                        ),
                        cr7bb_amount
                    ),
                    MaxDayCount,
                    Max(
                        Filter(
                            '[THFinanceCashCollection]Transactions',
                            cr7bb_customercode = ThisRecord.cr7bb_customercode &&
                            !cr7bb_processed
                        ),
                        cr7bb_daycount
                    )
                ),
                TotalDue > 100000 || MaxDayCount >= 3
            )
        );

        // Get activity for selected date (10 records from that day)
        ClearCollect(
            colRecentActivity,
            FirstN(
                Sort(
                    Filter(
                        '[THFinanceCashCollection]Emaillogs',
                        DateValue(cr7bb_sentdatetime) = _selectedDate
                    ),
                    cr7bb_sentdatetime,
                    SortOrder.Descending
                ),
                10
            )
        );
    Children:
      # ===== MAIN CONTAINER =====
      - DCC_Container:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            DropShadow: =DropShadow.None
            Height: =Parent.Height
            Width: =Parent.Width
          Children:
            # ===== STANDARD HEADER =====
            - DCC_Header:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.Regular
                  Fill: =RGBA(0, 101, 161, 1)
                  Height: =55
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutGap: =10
                  PaddingLeft: =15
                  RadiusBottomLeft: =8
                  RadiusBottomRight: =8
                  RadiusTopLeft: =8
                  RadiusTopRight: =8
                  Width: =Parent.Width - 20
                  X: =10
                  Y: =10
                Children:
                  - DCC_MenuIcon:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        Color: =RGBA(255, 255, 255, 1)
                        Height: =50
                        Icon: =Icon.Hamburger
                        OnSelect: =Set(_showMenu, !_showMenu)
                        PaddingBottom: =10
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =10
                        Width: =50
                  - DCC_Title:
                      Control: Text@0.0.51
                      Properties:
                        Font: =Font.Lato
                        FontColor: =Color.White
                        Height: =50
                        PaddingLeft: =20
                        Size: =25
                        Text: ="Daily Control Center"
                        VerticalAlign: =VerticalAlign.Middle
                        Weight: ='TextCanvas.Weight'.Medium
                        Width: =400

            # ===== CONTENT CONTAINER =====
            - DCC_Content:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  DropShadow: =DropShadow.None
                  Fill: =RGBA(243, 242, 241, 1)
                  Height: =Parent.Height - 85
                  Width: =Parent.Width - 20
                  X: =10
                  Y: =75
                Children:
                  # ===== DATE PICKER SECTION (moved from header) =====
                  - DatePickerSection:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        DropShadow: =DropShadow.Regular
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =140
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =12
                        LayoutMinHeight: =0
                        LayoutMinWidth: =100
                        PaddingTop: =16
                        PaddingLeft: =24
                        PaddingRight: =24
                        PaddingBottom: =16
                        RadiusBottomLeft: =10
                        RadiusBottomRight: =10
                        RadiusTopLeft: =10
                        RadiusTopRight: =10
                        Width: =Parent.Width
                        X: =0
                        Y: =10
                      Children:
                        # Title Row
                        - DatePickerTitleRow:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              LayoutDirection: =LayoutDirection.Horizontal
                              LayoutAlignItems: =LayoutAlignItems.Center
                              LayoutGap: =20
                              Height: =40
                              LayoutMinHeight: =0
                              LayoutMinWidth: =100
                              DropShadow: =DropShadow.None
                            Children:
                              - DatePickerSectionTitle:
                                  Control: Text@0.0.51
                                  Properties:
                                    Text: ="Audit Date Selection"
                                    Font: =Font.Lato
                                    Weight: ='TextCanvas.Weight'.Bold
                                    FontColor: =RGBA(0, 101, 161, 1)
                                    Size: =20
                                    Width: =400
                                    Height: =40
                                    VerticalAlign: =VerticalAlign.Middle
                              - RefreshButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="‚Üª Refresh"
                                    BasePaletteColor: =RGBA(0, 101, 161, 1)
                                    FontColor: =RGBA(255, 255, 255, 1)
                                    Height: =40
                                    Width: =120
                                    OnSelect: =Set(_refreshTrigger, !_refreshTrigger)

                        # Date Navigation Row
                        - DateNavigationRow:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              LayoutDirection: =LayoutDirection.Horizontal
                              LayoutAlignItems: =LayoutAlignItems.Center
                              LayoutGap: =12
                              Height: =50
                              LayoutMinHeight: =0
                              LayoutMinWidth: =100
                              DropShadow: =DropShadow.None
                            Children:
                              - DateLabel:
                                  Control: Text@0.0.51
                                  Properties:
                                    Text: ="View Date:"
                                    Font: =Font.Lato
                                    Weight: ='TextCanvas.Weight'.Semibold
                                    FontColor: =RGBA(0, 101, 161, 1)
                                    Size: =16
                                    Width: =100
                                    Height: =50
                                    VerticalAlign: =VerticalAlign.Middle

                              - PreviousDayButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="‚óÑ Previous"
                                    BasePaletteColor: =RGBA(0, 101, 161, 1)
                                    FontColor: =RGBA(255, 255, 255, 1)
                                    Height: =40
                                    Width: =120
                                    OnSelect: |-
                                      =Set(_selectedDate, DateAdd(_selectedDate, -1, TimeUnit.Days));
                                      Set(_refreshTrigger, !_refreshTrigger)

                              - SelectedDateDisplay:
                                  Control: Text@0.0.51
                                  Properties:
                                    Text: |-
                                      =Text(_selectedDate, "[$-th-TH]dd/mm/yyyy") &
                                      If(
                                          _selectedDate = Today(),
                                          " (Today)",
                                          ""
                                      )
                                    Font: =Font.Lato
                                    Weight: ='TextCanvas.Weight'.Bold
                                    FontColor: =RGBA(0, 101, 161, 1)
                                    Size: =16
                                    Width: =200
                                    Height: =50
                                    Align: ='TextCanvas.Align'.Center
                                    VerticalAlign: =VerticalAlign.Middle
                                    Fill: =RGBA(243, 242, 241, 1)

                              - NextDayButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="Next ‚ñ∫"
                                    BasePaletteColor: =RGBA(0, 101, 161, 1)
                                    FontColor: =RGBA(255, 255, 255, 1)
                                    Height: =40
                                    Width: =120
                                    DisplayMode: |-
                                      =If(
                                          _selectedDate >= Today(),
                                          DisplayMode.Disabled,
                                          DisplayMode.Edit
                                      )
                                    OnSelect: |-
                                      =Set(_selectedDate, DateAdd(_selectedDate, 1, TimeUnit.Days));
                                      Set(_refreshTrigger, !_refreshTrigger)

                              - TodayButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="Today"
                                    BasePaletteColor: |-
                                      =If(
                                          _selectedDate = Today(),
                                          RGBA(16, 124, 16, 1),
                                          RGBA(0, 101, 161, 1)
                                      )
                                    FontColor: =RGBA(255, 255, 255, 1)
                                    Height: =40
                                    Width: =100
                                    OnSelect: |-
                                      =Set(_selectedDate, Today());
                                      Set(_refreshTrigger, !_refreshTrigger)

                              - DatePickerButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="üìÖ Pick Date"
                                    BasePaletteColor: =RGBA(0, 101, 161, 1)
                                    FontColor: =RGBA(255, 255, 255, 1)
                                    Height: =40
                                    Width: =140
                                    OnSelect: =Set(_showDatePicker, !_showDatePicker)

                  # ===== MAIN SCROLL CONTAINER (Status, Actions, Activity) =====
                  - MainScrollContainer:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        Fill: =RGBA(243, 242, 241, 1)
                        Height: =Parent.Height - 170
                        Y: =160
                        Width: =Parent.Width
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =24
                        LayoutMinHeight: =40
                        LayoutMinWidth: =100
                        DropShadow: =DropShadow.None
                        PaddingTop: =24
                        PaddingLeft: =24
                        PaddingRight: =24
                        PaddingBottom: =24
                        LayoutOverflowY: =LayoutOverflow.Scroll
                      Children:
                        # ===== STATUS CARD =====
                        - StatusCard:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              Fill: =RGBA(255, 255, 255, 1)
                              DropShadow: =DropShadow.Light
                              Height: =180
                              LayoutMinHeight: =0
                              LayoutMinWidth: =1000
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutGap: =16
                              PaddingTop: =20
                              PaddingLeft: =20
                              PaddingRight: =20
                              PaddingBottom: =20
                            Children:
                              - StatusCardHeader:
                                  Control: Text@0.0.51
                                  Properties:
                                    Text: |-
                                      ="System Status - " & Text(_selectedDate, "[$-th-TH]dd/mm/yyyy")
                                    Font: =Font.Lato
                                    Weight: ='TextCanvas.Weight'.Bold
                                    FontColor: =RGBA(0, 101, 161, 1)
                                    Size: =20
                                    Width: =960
                                    Height: =32
                              - StatusIndicatorsContainer:
                                  Control: GroupContainer@1.3.0
                                  Variant: AutoLayout
                                  Properties:
                                    LayoutDirection: =LayoutDirection.Horizontal
                                    LayoutGap: =40
                                    Height: =90
                                    LayoutMinHeight: =0
                                    LayoutMinWidth: =960
                                    DropShadow: =DropShadow.None
                                  Children:
                                    # SAP Import Status
                                    - SAPImportStatus:
                                        Control: GroupContainer@1.3.0
                                        Variant: AutoLayout
                                        Properties:
                                          LayoutDirection: =LayoutDirection.Horizontal
                                          LayoutGap: =12
                                          LayoutAlignItems: =LayoutAlignItems.Center
                                          Height: =90
                                          Width: =400
                                          LayoutMinHeight: =0
                                          LayoutMinWidth: =100
                                          DropShadow: =DropShadow.None
                                        Children:
                                          - SAPStatusIcon:
                                              Control: Classic/Icon@2.5.0
                                              Properties:
                                                Icon: |-
                                                  =With(
                                                      {
                                                          _trigger: _refreshTrigger,
                                                          _log: First(Filter('[THFinanceCashCollection]Process Logs', cr7bb_processdate = Text(_selectedDate, "yyyy-mm-dd")))
                                                      },
                                                      If(
                                                          !IsBlank(_log) && _log.cr7bb_status = "Completed",
                                                          Icon.CheckBadge,
                                                          If(
                                                              !IsBlank(_log) && _log.cr7bb_status = "Failed",
                                                              Icon.CancelBadge,
                                                              Icon.Clock
                                                          )
                                                      )
                                                  )
                                                Color: |-
                                                  =With(
                                                      {
                                                          _trigger: _refreshTrigger,
                                                          _log: First(Filter('[THFinanceCashCollection]Process Logs', cr7bb_processdate = Text(_selectedDate, "yyyy-mm-dd")))
                                                      },
                                                      If(
                                                          !IsBlank(_log) && _log.cr7bb_status = "Completed",
                                                          RGBA(16, 124, 16, 1),
                                                          If(
                                                              !IsBlank(_log) && _log.cr7bb_status = "Failed",
                                                              RGBA(168, 0, 0, 1),
                                                              RGBA(96, 94, 92, 1)
                                                          )
                                                      )
                                                  )
                                                Width: =64
                                                Height: =64
                                          - SAPStatusDetails:
                                              Control: GroupContainer@1.3.0
                                              Variant: AutoLayout
                                              Properties:
                                                LayoutDirection: =LayoutDirection.Vertical
                                                LayoutGap: =4
                                                Height: =80
                                                Width: =320
                                                LayoutMinHeight: =0
                                                LayoutMinWidth: =100
                                                DropShadow: =DropShadow.None
                                              Children:
                                                - SAPStatusTitle:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: ="SAP Import"
                                                      Font: =Font.'Segoe UI'
                                                      Weight: ='TextCanvas.Weight'.Semibold
                                                      FontColor: =RGBA(50, 49, 48, 1)
                                                      Size: =16
                                                      Width: =320
                                                      Height: =28
                                                - SAPStatusText:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: |-
                                                        =With(
                                                            {
                                                                _trigger: _refreshTrigger,
                                                                _log: First(Filter('[THFinanceCashCollection]Process Logs', cr7bb_processdate = Text(_selectedDate, "yyyy-mm-dd")))
                                                            },
                                                            If(
                                                                IsBlank(_log),
                                                                "No run recorded",
                                                                _log.cr7bb_status & " at " &
                                                                Text(DateTimeValue(_log.cr7bb_processdate), "[$-th-TH]hh:mm")
                                                            )
                                                        )
                                                      Font: =Font.'Segoe UI'
                                                      FontColor: =RGBA(96, 94, 92, 1)
                                                      Size: =14
                                                      Width: =320
                                                      Height: =24
                                                - SAPRecordCount:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: |-
                                                        =With(
                                                            {
                                                                _trigger: _refreshTrigger,
                                                                _log: First(Filter('[THFinanceCashCollection]Process Logs', cr7bb_processdate = Text(_selectedDate, "yyyy-mm-dd")))
                                                            },
                                                            If(
                                                                !IsBlank(_log),
                                                                _log.cr7bb_recordsprocessed & " transactions processed",
                                                                ""
                                                            )
                                                        )
                                                      Font: =Font.'Segoe UI'
                                                      FontColor: =RGBA(96, 94, 92, 1)
                                                      Size: =12
                                                      Width: =320
                                                      Height: =20

                                    # Email Engine Status
                                    - EmailEngineStatus:
                                        Control: GroupContainer@1.3.0
                                        Variant: AutoLayout
                                        Properties:
                                          LayoutDirection: =LayoutDirection.Horizontal
                                          LayoutGap: =12
                                          LayoutAlignItems: =LayoutAlignItems.Center
                                          Height: =90
                                          Width: =400
                                          LayoutMinHeight: =0
                                          LayoutMinWidth: =100
                                          DropShadow: =DropShadow.None
                                        Children:
                                          - EmailStatusIcon:
                                              Control: Classic/Icon@2.5.0
                                              Properties:
                                                Icon: |-
                                                  =With(
                                                      {
                                                          _trigger: _refreshTrigger,
                                                          _sent: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Sent)),
                                                          _failed: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Failed))
                                                      },
                                                      If(
                                                          _sent > 0 && _failed = 0,
                                                          Icon.CheckBadge,
                                                          If(
                                                              _failed > 0,
                                                              Icon.Warning,
                                                              Icon.Clock
                                                          )
                                                      )
                                                  )
                                                Color: |-
                                                  =With(
                                                      {
                                                          _trigger: _refreshTrigger,
                                                          _sent: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Sent)),
                                                          _failed: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Failed))
                                                      },
                                                      If(
                                                          _sent > 0 && _failed = 0,
                                                          RGBA(16, 124, 16, 1),
                                                          If(
                                                              _failed > 0,
                                                              RGBA(255, 185, 0, 1),
                                                              RGBA(96, 94, 92, 1)
                                                          )
                                                      )
                                                  )
                                                Width: =64
                                                Height: =64
                                          - EmailStatusDetails:
                                              Control: GroupContainer@1.3.0
                                              Variant: AutoLayout
                                              Properties:
                                                LayoutDirection: =LayoutDirection.Vertical
                                                LayoutGap: =4
                                                Height: =80
                                                Width: =320
                                                LayoutMinHeight: =0
                                                LayoutMinWidth: =100
                                                DropShadow: =DropShadow.None
                                              Children:
                                                - EmailStatusTitle:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: ="Email Engine"
                                                      Font: =Font.'Segoe UI'
                                                      Weight: ='TextCanvas.Weight'.Semibold
                                                      FontColor: =RGBA(50, 49, 48, 1)
                                                      Size: =16
                                                      Width: =320
                                                      Height: =28
                                                - EmailStatusText:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: |-
                                                        =With(
                                                            {
                                                                _trigger: _refreshTrigger,
                                                                _sent: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Sent)),
                                                                _failed: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Failed))
                                                            },
                                                            If(
                                                                _sent = 0 && _failed = 0,
                                                                "No emails sent",
                                                                _sent & " sent, " & _failed & " failed"
                                                            )
                                                        )
                                                      Font: =Font.'Segoe UI'
                                                      FontColor: =RGBA(96, 94, 92, 1)
                                                      Size: =14
                                                      Width: =320
                                                      Height: =24
                                                - EmailSkippedCount:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: |-
                                                        =With(
                                                            {
                                                                _trigger: _refreshTrigger,
                                                                _skipped: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Skipped))
                                                            },
                                                            If(
                                                                _skipped > 0,
                                                                _skipped & " customers skipped (CN > DN)",
                                                                ""
                                                            )
                                                        )
                                                      Font: =Font.'Segoe UI'
                                                      FontColor: =RGBA(96, 94, 92, 1)
                                                      Size: =12
                                                      Width: =320
                                                      Height: =20

                        # ===== QUICK ACTIONS =====
                        - QuickActionsCard:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              Fill: =RGBA(255, 255, 255, 1)
                              DropShadow: =DropShadow.Light
                              Height: =140
                              LayoutMinHeight: =0
                              LayoutMinWidth: =1000
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutGap: =16
                              PaddingTop: =20
                              PaddingLeft: =20
                              PaddingRight: =20
                              PaddingBottom: =20
                            Children:
                              - QuickActionsHeader:
                                  Control: Text@0.0.51
                                  Properties:
                                    Text: ="Quick Actions"
                                    Font: =Font.Lato
                                    Weight: ='TextCanvas.Weight'.Bold
                                    FontColor: =RGBA(0, 101, 161, 1)
                                    Size: =20
                                    Width: =960
                                    Height: =32
                              - QuickActionsButtons:
                                  Control: GroupContainer@1.3.0
                                  Variant: AutoLayout
                                  Properties:
                                    LayoutDirection: =LayoutDirection.Horizontal
                                    LayoutGap: =16
                                    Height: =50
                                    LayoutMinHeight: =0
                                    LayoutMinWidth: =960
                                    DropShadow: =DropShadow.None
                                  Children:
                                    - ReviewEmailsButton:
                                        Control: Button@0.0.45
                                        Properties:
                                          Text: ="üìß Review Emails"
                                          BasePaletteColor: =RGBA(0, 101, 161, 1)
                                          FontColor: =RGBA(255, 255, 255, 1)
                                          Height: =50
                                          Width: =200
                                          OnSelect: |-
                                            =Set(gblFilterDate, _selectedDate);
                                            Navigate(scnEmailMonitor)
                                    - ViewFailedButton:
                                        Control: Button@0.0.45
                                        Properties:
                                          Text: |-
                                            =With(
                                                {
                                                    _trigger: _refreshTrigger,
                                                    _failed: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Failed))
                                                },
                                                "‚ö†Ô∏è Failed (" & _failed & ")"
                                            )
                                          BasePaletteColor: |-
                                            =With(
                                                {
                                                    _trigger: _refreshTrigger,
                                                    _failed: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Failed))
                                                },
                                                If(
                                                    _failed > 0,
                                                    RGBA(168, 0, 0, 1),
                                                    RGBA(200, 198, 196, 1)
                                                )
                                            )
                                          FontColor: =RGBA(255, 255, 255, 1)
                                          Height: =50
                                          Width: =180
                                          DisplayMode: |-
                                            =With(
                                                {
                                                    _trigger: _refreshTrigger,
                                                    _failed: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate && cr7bb_sendstatus = 'Send Status Choice'.Failed))
                                                },
                                                If(
                                                    _failed > 0,
                                                    DisplayMode.Edit,
                                                    DisplayMode.Disabled
                                                )
                                            )
                                          OnSelect: |-
                                            =Set(gblFilterDate, _selectedDate);
                                            Set(gblEmailStatusFilter, "Failed");
                                            Navigate(scnEmailMonitor)
                                    - CustomerLookupButton:
                                        Control: Button@0.0.45
                                        Properties:
                                          Text: ="üîç Customers"
                                          BasePaletteColor: =RGBA(100, 81, 61, 1)
                                          FontColor: =RGBA(255, 255, 255, 1)
                                          Height: =50
                                          Width: =180
                                          OnSelect: =Navigate(scnCustomer)
                                    - TransactionsButton:
                                        Control: Button@0.0.45
                                        Properties:
                                          Text: ="üìä Transactions"
                                          BasePaletteColor: =RGBA(0, 101, 161, 1)
                                          FontColor: =RGBA(255, 255, 255, 1)
                                          Height: =50
                                          Width: =200
                                          OnSelect: |-
                                            =Set(gblFilterDate, _selectedDate);
                                            Navigate(scnTransactions)
                                    - ExportReportButton:
                                        Control: Button@0.0.45
                                        Properties:
                                          Text: ="üìÑ Export Report"
                                          BasePaletteColor: =RGBA(100, 81, 61, 1)
                                          FontColor: =RGBA(255, 255, 255, 1)
                                          Height: =50
                                          Width: =200
                                          OnSelect: |-
                                            =Notify("Export functionality coming soon", NotificationType.Information)

                        # ===== ACTIVITY SUMMARY =====
                        - ActivitySummaryCard:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              Fill: =RGBA(255, 255, 255, 1)
                              DropShadow: =DropShadow.Light
                              LayoutMinHeight: =250
                              LayoutMinWidth: =1000
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutGap: =16
                              PaddingTop: =20
                              PaddingLeft: =20
                              PaddingRight: =20
                              PaddingBottom: =20
                            Children:
                              - ActivityHeader:
                                  Control: Text@0.0.51
                                  Properties:
                                    Text: |-
                                      =With(
                                          {
                                              _trigger: _refreshTrigger,
                                              _count: CountRows(Filter('[THFinanceCashCollection]Emaillogs', DateValue(cr7bb_sentdatetime) = _selectedDate))
                                          },
                                          "Activity - " & Text(_selectedDate, "[$-th-TH]dd/mm/yyyy") & " (" & _count & " emails)"
                                      )
                                    Font: =Font.Lato
                                    Weight: ='TextCanvas.Weight'.Bold
                                    FontColor: =RGBA(0, 101, 161, 1)
                                    Size: =20
                                    Width: =960
                                    Height: =32
                              - ActivityGallery:
                                  Control: Gallery@2.15.0
                                  Variant: Vertical
                                  Properties:
                                    Items: |-
                                      =If(
                                          _refreshTrigger || !_refreshTrigger,
                                          FirstN(
                                              Sort(
                                                  Filter(
                                                      '[THFinanceCashCollection]Emaillogs',
                                                      DateValue(cr7bb_sentdatetime) = _selectedDate
                                                  ),
                                                  cr7bb_sentdatetime,
                                                  SortOrder.Descending
                                              ),
                                              10
                                          )
                                      )
                                    Height: =350
                                    Width: =960
                                    LayoutMinHeight: =200
                                    TemplatePadding: =0
                                    TemplateSize: =70
                                  Children:
                                    - ActivityItemContainer:
                                        Control: GroupContainer@1.3.0
                                        Variant: AutoLayout
                                        Properties:
                                          Fill: =RGBA(250, 249, 248, 1)
                                          Height: =60
                                          Width: =940
                                          LayoutDirection: =LayoutDirection.Horizontal
                                          LayoutGap: =16
                                          LayoutAlignItems: =LayoutAlignItems.Center
                                          LayoutMinHeight: =0
                                          LayoutMinWidth: =100
                                          DropShadow: =DropShadow.None
                                          PaddingLeft: =16
                                          PaddingRight: =16
                                        Children:
                                          - ActivityIcon:
                                              Control: Classic/Icon@2.5.0
                                              Properties:
                                                Icon: |-
                                                  =If(
                                                      ThisItem.cr7bb_sendstatus = 'Send Status Choice'.Sent,
                                                      Icon.CheckBadge,
                                                      If(
                                                          ThisItem.cr7bb_sendstatus = 'Send Status Choice'.Failed,
                                                          Icon.Warning,
                                                          Icon.Send
                                                      )
                                                  )
                                                Color: |-
                                                  =If(
                                                      ThisItem.cr7bb_sendstatus = 'Send Status Choice'.Sent,
                                                      RGBA(16, 124, 16, 1),
                                                      If(
                                                          ThisItem.cr7bb_sendstatus = 'Send Status Choice'.Failed,
                                                          RGBA(168, 0, 0, 1),
                                                          RGBA(96, 94, 92, 1)
                                                      )
                                                  )
                                                Width: =40
                                                Height: =40
                                          - ActivityDetails:
                                              Control: GroupContainer@1.3.0
                                              Variant: AutoLayout
                                              Properties:
                                                LayoutDirection: =LayoutDirection.Vertical
                                                LayoutGap: =2
                                                Height: =50
                                                Width: =600
                                                LayoutMinHeight: =0
                                                LayoutMinWidth: =100
                                                DropShadow: =DropShadow.None
                                              Children:
                                                - ActivityText:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: |-
                                                        ="Email " & Text(ThisItem.cr7bb_sendstatus) & " to " &
                                                        ThisItem.cr7bb_customer.cr7bb_customername
                                                      Font: =Font.'Segoe UI'
                                                      Weight: ='TextCanvas.Weight'.Semibold
                                                      FontColor: =RGBA(50, 49, 48, 1)
                                                      Size: =13
                                                      Width: =600
                                                      Height: =26
                                                - ActivityTimestamp:
                                                    Control: Text@0.0.51
                                                    Properties:
                                                      Text: |-
                                                        =Text(ThisItem.cr7bb_sentdatetime, "[$-th-TH]hh:mm:ss")
                                                      Font: =Font.'Segoe UI'
                                                      FontColor: =RGBA(96, 94, 92, 1)
                                                      Size: =11
                                                      Width: =600
                                                      Height: =20
                                          - ActivityStatus:
                                              Control: Text@0.0.51
                                              Properties:
                                                Text: =Text(ThisItem.cr7bb_sendstatus)
                                                Font: =Font.'Segoe UI'
                                                Weight: ='TextCanvas.Weight'.Semibold
                                                FontColor: |-
                                                  =If(
                                                      ThisItem.cr7bb_sendstatus = 'Send Status Choice'.Sent,
                                                      RGBA(16, 124, 16, 1),
                                                      If(
                                                          ThisItem.cr7bb_sendstatus = 'Send Status Choice'.Failed,
                                                          RGBA(168, 0, 0, 1),
                                                          RGBA(96, 94, 92, 1)
                                                      )
                                                  )
                                                Size: =12
                                                Width: =120
                                                Height: =26
                                                Align: ='TextCanvas.Align'.Center
                                                VerticalAlign: =VerticalAlign.Middle
                                          - ViewDetailsBtn:
                                              Control: Button@0.0.45
                                              Properties:
                                                Text: ="View"
                                                BasePaletteColor: =RGBA(0, 101, 161, 1)
                                                FontColor: =RGBA(255, 255, 255, 1)
                                                Height: =35
                                                Width: =80
                                                OnSelect: |-
                                                  =Set(gblSelectedEmail, ThisItem);
                                                  Navigate(scnEmailMonitor)

            # ===== DATE PICKER OVERLAY =====
            - DatePickerOverlay:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  Visible: =_showDatePicker
                  Fill: =RGBA(0, 0, 0, 0.5)
                  X: =0
                  Y: =0
                  Width: =Parent.Width
                  Height: =Parent.Height
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutMinHeight: =0
                  LayoutMinWidth: =100
                  DropShadow: =DropShadow.None
                Children:
                  - DatePickerCard:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        Fill: =RGBA(255, 255, 255, 1)
                        DropShadow: =DropShadow.Light
                        Width: =400
                        Height: =450
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =16
                        LayoutMinHeight: =0
                        LayoutMinWidth: =400
                        PaddingTop: =20
                        PaddingLeft: =20
                        PaddingRight: =20
                        PaddingBottom: =20
                      Children:
                        - DatePickerHeader:
                            Control: Text@0.0.51
                            Properties:
                              Text: ="Select Audit Date"
                              Font: =Font.Lato
                              Weight: ='TextCanvas.Weight'.Bold
                              FontColor: =RGBA(0, 101, 161, 1)
                              Size: =20
                              Width: =360
                              Height: =32

                        - DatePickerControl:
                            Control: DatePicker@0.0.46
                            Properties:
                              SelectedDate: =_selectedDate
                              Height: =320
                              Width: =360

                        - DatePickerButtons:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              LayoutDirection: =LayoutDirection.Horizontal
                              LayoutGap: =12
                              Height: =50
                              LayoutMinHeight: =0
                              LayoutMinWidth: =100
                              DropShadow: =DropShadow.None
                            Children:
                              - DatePickerSelectButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="Select Date"
                                    BasePaletteColor: =RGBA(0, 101, 161, 1)
                                    FontColor: =RGBA(255, 255, 255, 1)
                                    Height: =50
                                    Width: =174
                                    OnSelect: |-
                                      =Set(_selectedDate, DatePickerControl.SelectedDate);
                                      Set(_showDatePicker, false);
                                      Set(_refreshTrigger, !_refreshTrigger)

                              - DatePickerCancelButton:
                                  Control: Button@0.0.45
                                  Properties:
                                    Text: ="Cancel"
                                    BasePaletteColor: =RGBA(200, 198, 196, 1)
                                    FontColor: =RGBA(50, 49, 48, 1)
                                    Height: =50
                                    Width: =174
                                    OnSelect: =Set(_showDatePicker, false)

            # ===== NAVIGATION MENU =====
            - DCC_NavigationMenu:
                Control: CanvasComponent
                ComponentName: NavigationMenu
                Properties:
                  Fill: =RGBA(255, 255, 255, 0.5)
                  Height: =Parent.Height - 70
                  Visible: =If(_showMenu, true, false)
                  Width: =260
                  Y: =70
                  navItems: =Navigation
                  navSelected: =currentScreen
