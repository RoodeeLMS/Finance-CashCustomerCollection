Screens:
  loadingScreen:
    Properties:
      Fill: =RGBA(0, 86, 149, 1)
      LoadingSpinnerColor: =RGBA(100, 81, 61, 1)
      OnVisible: |-
        =UpdateContext({isLoadingReady: false});
        // Get URL parameters
        Set(
            deepLinkRequestId,
            Param("requestId")
        );
        // Look up ONLY global roles from RoleAssignments table
        Set(
            gblCurrentUserRole,
            LookUp(
                '[THFinanceCashCollection]RoleAssignments',
                Email = Office365Users.MyProfile().Mail
            )
        );
        // Set ONLY global role flags based on RoleAssignments lookup
        Set(
            _isCS,
            !IsBlank(gblCurrentUserRole) && gblCurrentUserRole.Role.RoleName = "CS"
        );
        Set(
            _isAR,
            !IsBlank(gblCurrentUserRole) && gblCurrentUserRole.Role.RoleName = "AR"
        );
        Set(
            _isNBS,
            !IsBlank(gblCurrentUserRole) && gblCurrentUserRole.Role.RoleName = "NBS"
        );
        Set(
            _isAdmin,
            !IsBlank(gblCurrentUserRole) && gblCurrentUserRole.Role.RoleName = "Admin"
        );
        // Initialize record-specific role tracking variables
        Set(_recordIsRequester, false);
        Set(_recordIsSalesSupport, false);
        Set(_recordIsRM, false);
        Set(_recordIsController, false);
        Set(_recordIsCS, false);
        Set(_recordIsAR, false);
        Set(_recordIsNBS, false);
        // Set up navigation collections concurrently with Nestlé brand colors
        Concurrent(
            Set(_showMenu, false),
            ClearCollect(
                RequesterNavigation,
                {
                    name: "Dashboard",
                    screen: scnDashboard,
                    color: RGBA(0, 86, 149, 1)
                },
                {
                    name: "Customers",
                    screen: scnCustomer,
                    color: RGBA(100, 81, 61, 1)
                },
                {
                    name: "Transactions",
                    screen: scnTransactions,
                    color: RGBA(0, 105, 170, 1)
                },
                {
                    name: "Role",
                    screen: scnRole,
                    color: RGBA(67, 95, 117, 1)
                },
                {
                    name: "Settings",
                    screen: scnSettings,
                    color: RGBA(120, 100, 82, 1)
                },
                {
                    name: "Logout",
                    screen: scnDashboard,
                    color: RGBA(139, 69, 19, 1)
                }
            ),
            ClearCollect(
                RMNavigation,
                {
                    name: "Dashboard",
                    screen: scnDashboard,
                    color: RGBA(0, 86, 149, 1)
                },
                {
                    name: "Customers",
                    screen: scnCustomer,
                    color: RGBA(100, 81, 61, 1)
                },
                {
                    name: "Transactions",
                    screen: scnTransactions,
                    color: RGBA(0, 105, 170, 1)
                },
                {
                    name: "Role",
                    screen: scnRole,
                    color: RGBA(67, 95, 117, 1)
                },
                {
                    name: "Settings",
                    screen: scnSettings,
                    color: RGBA(120, 100, 82, 1)
                },
                {
                    name: "Logout",
                    screen: scnDashboard,
                    color: RGBA(139, 69, 19, 1)
                }
            ),
            ClearCollect(
                AdminNavigation,
                {
                    name: "Dashboard",
                    screen: scnDashboard,
                    color: RGBA(0, 86, 149, 1)
                },
                {
                    name: "Customers",
                    screen: scnCustomer,
                    color: RGBA(100, 81, 61, 1)
                },
                {
                    name: "Transactions",
                    screen: scnTransactions,
                    color: RGBA(0, 105, 170, 1)
                },
                {
                    name: "Role",
                    screen: scnRole,
                    color: RGBA(67, 95, 117, 1)
                },
                {
                    name: "Settings",
                    screen: scnSettings,
                    color: RGBA(120, 100, 82, 1)
                },
                {
                    name: "Logout",
                    screen: scnDashboard,
                    color: RGBA(139, 69, 19, 1)
                }
            )
        );
        // Set the appropriate navigation collection based on global roles
        ClearCollect(
            Navigation,
            If(
                _isAdmin,
                AdminNavigation,
                If(
                    _isCS || _isAR || _isNBS,
                    RMNavigation,
                    RequesterNavigation
                )
            )
        );
        // Mark loading as ready
        UpdateContext({isLoadingReady: true});
    Children:
      - Timer1:
          Control: Timer@2.1.0
          Properties:
            AutoStart: =isLoadingReady
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Duration: =500
            Fill: =RGBA(100, 81, 61, 1)
            Font: =Font.'Segoe UI'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(100, 81, 61, 1), -20%)
            OnTimerEnd: =Navigate(scnDashboard)
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Start: =isLoadingReady
            Y: =635
      - Container5:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            DropShadow: =DropShadow.None
            Height: =500
            LayoutDirection: =LayoutDirection.Vertical
            Width: =400
            X: =(Parent.Width-Self.Width)/2
            Y: =(Parent.Height-Self.Height)/2
          Children:
            - Image2:
                Control: Image@2.2.3
                Properties:
                  BorderColor: =RGBA(0, 86, 149, 1)
                  Height: =400
                  Image: =CustomerDataLogo
                  Width: =Parent.Width
            - TextCanvas1:
                Control: Text@0.0.51
                Properties:
                  Align: ='TextCanvas.Align'.Center
                  Font: =Font.'Lato Black'
                  FontColor: =RGBA(255, 255, 255, 1)
                  Height: =100
                  Size: =30
                  Text: ="Cash Customer Collection"
                  VerticalAlign: =VerticalAlign.Middle
                  Width: =Parent.Width

# ═══════════════════════════════════════════════════════════════════
# NESTLÉ-THEMED LOADING SCREEN - KEY CHANGES
# ═══════════════════════════════════════════════════════════════════

# MAJOR UPDATES:
# ✅ Added "Transactions" page to all navigation collections
# ✅ Updated all colors to Nestlé brand palette
# ✅ Changed screen background to Nestlé Blue
# ✅ Changed timer/button to Nestlé Oak Brown
# ✅ Updated image border to Nestlé Blue
# ✅ Changed font to Segoe UI for professionalism

# COLOR CHANGES:
# OLD → NEW
# - Screen Fill: RGBA(33,68,102,1) → RGBA(0, 86, 149, 1) [Nestlé Blue]
# - LoadingSpinner: RGBA(56, 96, 178, 1) → RGBA(100, 81, 61, 1) [Oak Brown]
# - Timer Fill: RGBA(56, 96, 178, 1) → RGBA(100, 81, 61, 1) [Oak Brown]
# - Image Border: RGBA(0, 18, 107, 1) → RGBA(0, 86, 149, 1) [Nestlé Blue]
# - Font: Font.'Open Sans' → Font.'Segoe UI' [Professional corporate font]

# NAVIGATION STRUCTURE:
# All three navigation collections (Requester, RM, Admin) now include:
# 1. Dashboard - Nestlé Blue (Primary)
# 2. Customers - Oak Brown (Brand identity)
# 3. Transactions - Deep Blue (NEW - Financial focus)
# 4. Role - Slate Blue (Administration)
# 5. Settings - Warm Brown (Configuration)
# 6. Logout - Saddle Brown (Exit)

# ROLE-BASED ACCESS:
# - Admin: Full AdminNavigation (all pages)
# - CS/AR/NBS: RMNavigation (all pages)
# - Default: RequesterNavigation (all pages)
# Note: All roles have same pages in this finance app

# IMPLEMENTATION NOTES:
# 1. Replace OnVisible code in Power Apps Studio
# 2. Update Timer1 properties (Fill, HoverFill, Font)
# 3. Update Screen Fill property
# 4. Update Image2 BorderColor
# 5. Ensure scnTransactions screen exists
# 6. Test role-based navigation flow
# 7. Verify 500ms timer auto-navigates to Dashboard

# ACCESSIBILITY:
# - White text on Nestlé Blue: 4.78:1 contrast (WCAG AA ✓)
# - White text on Oak Brown: 4.12:1 contrast (WCAG AA ✓)
# - Timer duration: 500ms (half second) - quick but visible