Screens:
  loadingScreen:
    Properties:
      Fill: =RGBA(40, 134, 222, 1)
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
      OnVisible: |
        =UpdateContext({isLoadingReady:false});

        /* Detect user roles */
        Set(_isHR, !IsEmpty(Filter('[THInterviewEval]RoleAssignments', Email = Office365Users.MyProfile().Mail && Role.Name = "HR")));
        Set(_isAdmin, !IsEmpty(Filter('[THInterviewEval]RoleAssignments', Email = Office365Users.MyProfile().Mail && Role.Name = "Admin")));
        Set(_isInterviewer, !IsEmpty(Filter('[THInterviewEval]PositionInterviews', InterviewerEmail = Office365Users.MyProfile().Mail)));

        // Initialize global variables with typed defaults
        Set(gblLanguage, "EN");
        Set(gblSelectedEvaluation, First('[THInterviewEval]InterviewEvaluations'));
        Set(gblCurrentQuestionIndex, 1);

        Concurrent(
            Set(_showMenu, false),

            /* Interviewer Navigation - Basic access only */
            ClearCollect(InterviewerNavigation,
                {name: "Dashboard", screen: scnDashboard, color: RGBA(0,101,161,1)},
                {name: "My Evaluations", screen: scnInterviewerPendingEvals, color: RGBA(0,101,161,1)},
                {name: "Role", screen: scnRole, color: RGBA(100,81,61,1)},
                {name: "Settings", screen: scnSettings, color: RGBA(100,81,61,1)}
            ),

            /* HR Navigation - Management access */
            ClearCollect(HRNavigation,
                {name: "Dashboard", screen: scnDashboard, color: RGBA(0,101,161,1)},
                {name: "My Evaluations", screen: scnInterviewerPendingEvals, color: RGBA(0,101,161,1)},
                {name: "Position", screen: scnPositionLibrary, color: RGBA(0,101,161,1)},
                {name: "Candidate", screen: scnCandidate, color: RGBA(0,101,161,1)},
                {name: "Evaluation Form", screen: scnEvalFormLibrary, color: RGBA(0,101,161,1)},
                {name: "Role", screen: scnRole, color: RGBA(100,81,61,1)},
                {name: "Settings", screen: scnSettings, color: RGBA(100,81,61,1)}
            ),

            /* Admin Navigation - Full access */
            ClearCollect(AdminNavigation,
                {name: "Dashboard", screen: scnDashboard, color: RGBA(0,101,161,1)},
                {name: "My Evaluations", screen: scnInterviewerPendingEvals, color: RGBA(0,101,161,1)},
                {name: "Position", screen: scnPositionLibrary, color: RGBA(0,101,161,1)},
                {name: "Candidate", screen: scnCandidate, color: RGBA(0,101,161,1)},
                {name: "Evaluation Form", screen: scnEvalFormLibrary, color: RGBA(0,101,161,1)},
                {name: "Role", screen: scnRole, color: RGBA(100,81,61,1)},
                {name: "Settings", screen: scnSettings, color: RGBA(100,81,61,1)}
            )
        );

        /* Select navigation based on highest privilege (Admin > HR > Interviewer) */
        ClearCollect(Navigation, If(_isAdmin, AdminNavigation, If(_isHR, HRNavigation, InterviewerNavigation)));
        UpdateContext({isLoadingReady:true});
    Children:
      - Timer1:
          Control: Timer@2.1.0
          Properties:
            AutoStart: =isLoadingReady
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =ColorFade(Self.BorderColor, 70%)
            DisabledColor: =ColorFade(Self.Fill, 90%)
            DisabledFill: =ColorFade(Self.Fill, 70%)
            Duration: =500
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnTimerEnd: |-
              =
              //If(!_isRM && !_isAdmin,Navigate(scnUnauthorized),Navigate(scnDashboard));

              Navigate(scnDashboard)
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Start: =isLoadingReady
            Y: =635
      - TextCanvas1:
          Control: Text@0.0.51
          Properties:
            Align: ='TextCanvas.Align'.Center
            Font: =Font.'Lato Black'
            FontColor: =RGBA(255, 255, 255, 1)
            Height: =142
            Size: =30
            Text: ="Interview Evaluation"
            VerticalAlign: =VerticalAlign.Middle
            Width: =411
            X: =(Parent.Width-Self.Width)/2
            Y: =(Parent.Height-Self.Height)/2

