Screens:
  scnEvalFormLibrary:
    Properties:
      Fill: =RGBA(243, 242, 241, 1)
      LoadingSpinnerColor: =RGBA(0, 101, 161, 1)
      OnVisible: |-
        =// Set current screen for navigation
        UpdateContext({currentScreen:"Evaluation Form"});
        Set(_showMenu,false);

        // Initialize delete confirmation
        Set(showDeleteConfirmation, false);
        Set(formToDelete, Blank());
    Children:
      - FormLib_Container:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            DropShadow: =DropShadow.None
            Height: =Parent.Height
            Width: =Parent.Width
          Children:
            - FormLib_Header:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.Regular
                  Fill: =RGBA(0, 101, 161, 1)
                  Height: =55
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  PaddingLeft: =15
                  RadiusBottomLeft: =8
                  RadiusBottomRight: =8
                  RadiusTopLeft: =8
                  RadiusTopRight: =8
                  Width: =Parent.Width - 20
                  X: =10
                  Y: =10
                Children:
                  - FormLib_MenuIcon:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        Color: =RGBA(255, 255, 255, 1)
                        Height: =50
                        Icon: =Icon.Hamburger
                        OnSelect: =Set(_showMenu, !_showMenu)
                        PaddingBottom: =10
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =10
                        Width: =50
                  - FormLib_HeaderTitle:
                      Control: Text@0.0.51
                      Properties:
                        Font: =Font.Lato
                        FontColor: =Color.White
                        Height: =50
                        PaddingLeft: =20
                        Size: =25
                        Text: ="Evaluation Form Library"
                        VerticalAlign: =VerticalAlign.Middle
                        Weight: ='TextCanvas.Weight'.Medium
                        Width: =Parent.Width - FormLib_MenuIcon.Width - 40
            - FormLib_Content:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  DropShadow: =DropShadow.Regular
                  Fill: =RGBA(255, 255, 255, 1)
                  Height: =Parent.Height - 85
                  RadiusBottomLeft: =10
                  RadiusBottomRight: =10
                  RadiusTopLeft: =10
                  RadiusTopRight: =10
                  Width: =Parent.Width - 20
                  X: =10
                  Y: =75
                Children:
                  - FormLib_TableContainer:
                      Control: GroupContainer@1.3.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =Parent.Height - 20
                        RadiusBottomLeft: =10
                        RadiusBottomRight: =10
                        RadiusTopLeft: =10
                        RadiusTopRight: =10
                        Width: =Parent.Width - 20
                        X: =10
                        Y: =10
                      Children:
                        - FormLib_ActionBar:
                            Control: GroupContainer@1.3.0
                            Variant: AutoLayout
                            Properties:
                              Fill: =RGBA(245, 245, 245, 1)
                              Height: =50
                              LayoutAlignItems: =LayoutAlignItems.Center
                              LayoutDirection: =LayoutDirection.Horizontal
                              LayoutGap: =10
                              LayoutJustifyContent: =LayoutJustifyContent.End
                              PaddingLeft: =15
                              PaddingRight: =15
                              RadiusTopLeft: =10
                              RadiusTopRight: =10
                              Width: =Parent.Width
                            Children:
                              - FormLib_AddBtn:
                                  Control: Button@0.0.45
                                  Properties:
                                    BasePaletteColor: =RGBA(0, 101, 161, 1)
                                    Height: =35
                                    Icon: ="Add"
                                    OnSelect: |-
                                      =Set(gblSelectedEvalForm, Blank());
                                      Navigate(scnEvalFormBuilder);
                                    Text: ="Add Form"
                                    Width: =135
                              - FormLib_EditBtn:
                                  Control: Button@0.0.45
                                  Properties:
                                    BasePaletteColor: =RGBA(156, 220, 79, 1)
                                    DisplayMode: |-
                                      =If(
                                          IsBlankOrError(FormLib_FormsTable.Selected),
                                          DisplayMode.Disabled,
                                          DisplayMode.Edit
                                      )
                                    Height: =35
                                    Icon: ="Edit"
                                    OnSelect: |-
                                      =Set(gblSelectedEvalForm, FormLib_FormsTable.Selected);
                                      Navigate(scnEvalFormBuilder);
                                    Text: ="Edit"
                                    Width: =80
                              - FormLib_QuestionsBtn:
                                  Control: Button@0.0.45
                                  Properties:
                                    BasePaletteColor: =RGBA(100, 81, 61, 1)
                                    DisplayMode: |-
                                      =If(
                                          IsBlankOrError(FormLib_FormsTable.Selected),
                                          DisplayMode.Disabled,
                                          DisplayMode.Edit
                                      )
                                    Height: =35
                                    Icon: ="BulletedList"
                                    OnSelect: |-
                                      =Set(gblSelectedEvalForm, FormLib_FormsTable.Selected);
                                      Navigate(scnQuestionManager);
                                    Text: ="Questions"
                                    Width: =110
                              - FormLib_PreviewBtn:
                                  Control: Button@0.0.45
                                  Properties:
                                    BasePaletteColor: =RGBA(0, 120, 215, 1)
                                    DisplayMode: |-
                                      =If(
                                          IsBlankOrError(FormLib_FormsTable.Selected),
                                          DisplayMode.Disabled,
                                          DisplayMode.Edit
                                      )
                                    Height: =35
                                    Icon: ="View"
                                    OnSelect: |-
                                      =Set(gblSelectedEvalForm, FormLib_FormsTable.Selected);
                                      // Prepare form data for preview
                                      ClearCollect(colPreviewQuestions,
                                          Sort(
                                              Filter('[THInterviewEval]FormQuestions',
                                                  EvalForm.FormName = gblSelectedEvalForm.FormName
                                              ),
                                              DisplayOrder
                                          )
                                      );
                                      // Add index to questions
                                      Clear(colIndexedPreviewQuestions);
                                      ForAll(
                                          Sequence(CountRows(colPreviewQuestions)) As IndexNum,
                                          Collect(colIndexedPreviewQuestions,
                                              Patch(
                                                  Last(FirstN(colPreviewQuestions, IndexNum.Value)),
                                                  {QuestionIndex: IndexNum.Value}
                                              )
                                          )
                                      );
                                      ClearCollect(colPreviewAnswers, Blank());
                                      Set(gblCurrentQuestionIndex, 1);
                                      Navigate(scnFormPreview);
                                    Text: ="Preview"
                                    Width: =100
                              - FormLib_DeleteBtn:
                                  Control: Button@0.0.45
                                  Properties:
                                    BasePaletteColor: =RGBA(249, 83, 109, 1)
                                    DisplayMode: |-
                                      =If(
                                          IsBlankOrError(FormLib_FormsTable.Selected),
                                          DisplayMode.Disabled,
                                          DisplayMode.Edit
                                      )
                                    Height: =35
                                    Icon: ="Delete"
                                    OnSelect: |-
                                      =Set(formToDelete, FormLib_FormsTable.Selected);
                                      Set(showDeleteConfirmation, true);
                                    Text: ="Delete"
                                    Width: =90
                        - FormLib_FormsTable:
                            Control: Table@1.0.278
                            Properties:
                              DateTimeFormat: ='PowerAppsOneGrid.DateTimeFormat'.ShortDate
                              EnableRangeSelection: ='PowerAppsOneGrid.EnableRangeSelection'.Enable
                              Height: =Parent.Height - 60
                              Items: =Sort('[THInterviewEval]EvalForms','Created On')
                              ReflowBehavior: ='PowerAppsOneGrid.ReflowBehavior'.Reflow
                              ShowAvatar: ="no"
                              Width: =Parent.Width - 20
                              X: =10
                              Y: =55
                            Children:
                              - FormLib_FormNameCol:
                                  Control: TableDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Form Name (EN)"
                                    FieldName: ="cr76f_formname"
                                    FieldType: ="s"
                                    Order: =1
                              - FormLib_FormNameTHCol:
                                  Control: TableDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Form Name (TH)"
                                    FieldName: ="nc_formname_th"
                                    FieldType: ="s"
                                    Order: =2
                              - FormLib_TargetPositionCol:
                                  Control: TableDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Target Position"
                                    FieldName: ="cr76f_targetposition"
                                    FieldType: ="s"
                                    Order: =3
                              - FormLib_MaxScoreCol:
                                  Control: TableDataField@1.5.0
                                  Variant: textualColumn
                                  IsLocked: true
                                  Properties:
                                    FieldDisplayName: ="Max Score"
                                    FieldName: ="cr76f_maxscore"
                                    FieldType: ="n"
                                    Order: =4
            - FormLib_NavigationMenu:
                Control: CanvasComponent
                ComponentName: NavigationMenu
                Properties:
                  Fill: =RGBA(255, 255, 255, 0.5)
                  Height: =Parent.Height - 70
                  Visible: =If(_showMenu, true, false)
                  Width: =260
                  Y: =70
                  navItems: =Navigation
                  navSelected: =currentScreen
      - FormLib_DeleteOverlay:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(0, 0, 0, 0.7)
            Height: =Parent.Height
            Visible: =showDeleteConfirmation
            Width: =Parent.Width
          Children:
            - FormLib_ConfirmDialog:
                Control: GroupContainer@1.3.0
                Variant: ManualLayout
                Properties:
                  DropShadow: =DropShadow.Bold
                  Fill: =RGBA(255, 255, 255, 1)
                  Height: =220
                  RadiusBottomLeft: =10
                  RadiusBottomRight: =10
                  RadiusTopLeft: =10
                  RadiusTopRight: =10
                  X: =(Parent.Width - Self.Width) / 2
                  Y: =(Parent.Height - Self.Height) / 2
                Children:
                  - FormLib_ConfirmTitle:
                      Control: Text@0.0.51
                      Properties:
                        Align: ='TextCanvas.Align'.Center
                        Font: =Font.Lato
                        FontColor: =RGBA(249, 83, 109, 1)
                        Height: =40
                        Size: =20
                        Text: ="Delete Evaluation Form"
                        VerticalAlign: =VerticalAlign.Middle
                        Weight: ='TextCanvas.Weight'.Bold
                        Width: =Parent.Width
                        Y: =15
                  - FormLib_ConfirmMessage:
                      Control: Text@0.0.51
                      Properties:
                        Align: ='TextCanvas.Align'.Center
                        AutoHeight: =true
                        Font: =Font.Lato
                        Text: ="Are you sure you want to delete '" & formToDelete.FormName & "'?" & Char(10) & "This will also delete all associated questions and choices." & Char(10) & "This action cannot be undone."
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =65
                  - FormLib_ConfirmButtons:
                      Control: GroupContainer@1.3.0
                      Variant: AutoLayout
                      Properties:
                        Height: =50
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =15
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        Width: =Parent.Width
                        Y: =160
                      Children:
                        - FormLib_CancelDeleteBtn:
                            Control: Button@0.0.45
                            Properties:
                              BasePaletteColor: =RGBA(128, 128, 128, 1)
                              Height: =40
                              OnSelect: |-
                                =Set(showDeleteConfirmation, false);
                                Set(formToDelete, Blank());
                              Text: ="Cancel"
                              Width: =120
                        - FormLib_ConfirmDeleteBtn:
                            Control: Button@0.0.45
                            Properties:
                              BasePaletteColor: =RGBA(249, 83, 109, 1)
                              Height: =40
                              OnSelect: |-
                                =RemoveIf('[THInterviewEval]EvalForms',
                                    '[THInterviewEval]EvalForm' = formToDelete.'[THInterviewEval]EvalForm'
                                );
                                Set(showDeleteConfirmation, false);
                                Set(formToDelete, Blank());
                                Notify("Evaluation form deleted successfully", NotificationType.Success);
                              Text: ="Delete"
                              Width: =120
